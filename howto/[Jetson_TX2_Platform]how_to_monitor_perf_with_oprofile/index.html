<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>[Jetson TX2 Platform]how to monitor perf with oprofile - Apollo Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Apollo Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../quick_start.md" class="nav-link">Get Started</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Cyber RT <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../cyber/" class="dropdown-item">Introduction to Cyber RT</a>
</li>
                                    
<li>
    <a href="../../cyber/cyber_rt_quick_start.md" class="dropdown-item">Cyber RT Quick Start</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../FAQs/" class="nav-link">FAQs</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/ApolloAuto/apollo/edit/master/docs/howto/[Jetson_TX2_Platform]how_to_monitor_perf_with_oprofile.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            
            
            
            
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>oprofile is a performance monitoring tool that runs on linux system. Generally, oprofile has been included in linux system modules, but oprofile module is not supported on ARM, so we have to install it manually.</p>
<p>oprofile supports multi-thread program. It records the number of function calls, and can also output the source code to show results user-friendly. So it fits well to performance monitoring on TX2.</p>
<p>Notes: oprofile has been installed in image <code>dev_aarch64_20190102_1200</code> and late, so it doesn’t need to install oprofile in Docker environment anymore.</p>
<h4 id="download">Download</h4>
<p>Download the newest version of oprofile</p>
<pre><code class="bash">$ wget http://prdownloads.sourceforge.net/oprofile/oprofile-1.3.0.tar.gz
$ tar zxvf oprofile-1.3.0.tar.gz
$ cd oprofile-1.3.0
</code></pre>

<h4 id="installation">Installation</h4>
<pre><code class="bash">$ sudo apt-get install libpopt-dev libiberty-dev binutils-dev
$ ./configure
$ make -j4
$ sudo make install
</code></pre>

<h4 id="test">Test</h4>
<p>After installation，perform command <code>operf</code> to see if it could get CPU information normally. If it fails and the output is like this:</p>
<p><code>unable to open /sys/devices/system/cpu/cpu0/online</code></p>
<p>This is because TX2 only launches 4 CPU cores by default. The other two CPU cores are closed.
Use below command to open the other two CPU cores:</p>
<pre><code class="bash">$ sudo nvpmodel -m 0
</code></pre>

<h4 id="how-to-use">How to use</h4>
<p>oprofile provides variety of commands, the commands <code>operf</code>, <code>opreport</code> and <code>opannotate</code> are used more often.
Take testing perception as an example.</p>
<ul>
<li>1.modify <code>script/apollo_bash.sh</code>, add command <code>operf</code> behind keyword <code>nuhup</code> in line 239. As shown below：</li>
</ul>
<p><img alt="operf_command" src="../images/TX2/operf_command.png" /></p>
<ul>
<li>2.use script like <code>./script/perception.sh</code> to launch perception program</li>
</ul>
<p>And now, operf is collecting data of perception program. Stopping perception program in any approach can stop the collecting process.</p>
<h4 id="output">Output</h4>
<p>After stopping perception program, a directory named oprofile_data is generated in current directory.
Use command <code>opreport</code> to show the total statistics:</p>
<pre><code class="bash">$ opreport
</code></pre>

<p>As shown below:</p>
<p><img alt="opreport_" src="../images/TX2/opreport_.png" /></p>
<p>Use command <code>opreport</code> to show the statistics of each function:</p>
<pre><code class="bash">$ opreport -l bazel-bin/modules/perception/perception 
</code></pre>

<p>Because there is too much information to show, so it’s better to save the output into a file.</p>
<pre><code class="bash">$ opreport -l bazel-bin/modules/perception/perception &gt; perception_op_funcs.md
</code></pre>

<p>As shown below:</p>
<p><img alt="opreport_file" src="../images/TX2/opreport_file.png" /></p>
<p>Use command <code>opannotate</code> to show the statistics with source code:</p>
<pre><code class="bash">$ opannotate -s bazel-bin/modules/perception/perception &gt; perception_op_details.md
</code></pre>

<p>Notice:
It only supports one operf program to be running at any time, so when operf program is running, we could launch another program with <code>operf</code>.</p>
<p>oprofile official website:
<a href="http://oprofile.sourceforge.net/news/">http://oprofile.sourceforge.net/news/</a></p>
<p>oprofile user manual:
<a href="http://oprofile.sourceforge.net/doc/index.html">http://oprofile.sourceforge.net/doc/index.html</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
