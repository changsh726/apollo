<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>How to Run Offline Perception Visualizer - Apollo Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Apollo Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../quick_start.md" class="nav-link">Get Started</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Cyber RT <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../cyber/" class="dropdown-item">Introduction to Cyber RT</a>
</li>
                                    
<li>
    <a href="../../cyber/cyber_rt_quick_start.md" class="dropdown-item">Cyber RT Quick Start</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../FAQs/" class="nav-link">FAQs</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/ApolloAuto/apollo/edit/master/docs/howto/how_to_run_offline_perception_visualizer.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#how-to-run-offline-perception-visualizer" class="nav-link">How to Run Offline Perception Visualizer</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="how-to-run-offline-perception-visualizer">How to Run Offline Perception Visualizer</h1>
<p>The DreamView tool, can visualize and simulate the perception module, but it lacks the ability of visualizing point cloud and ROI areas which are helpful for debugging and testing perception algorithms. For this purpose, we provide an offline visualization tool based on OpenGL and PCL libraries to show obstacle perception results with point cloud. Please see <a href="http://apollo.auto/platform/perception.html">demo videos</a> for this offline perception visualizer on Apollo official website.</p>
<p>We introduce the detailed steps to build and run the offline visualizer in docker as below:</p>
<h3 id="1-prepare-pcd-and-pose-data">1. Prepare PCD and Pose Data</h3>
<p>Before running the visualizer, we need to prepare necessary PCD and Pose data which can be extracted from a ROS bag with recorded point cloud data. To facilitate the data extraction, we provide a ROS launch file to dump the PCD frame file and a python script to generate the Pose file for each frame.</p>
<h4 id="11-launching-the-pcd-exporter">1.1 Launching the PCD exporter</h4>
<p>Additional details can be found in the <a href="https://github.com/ApolloAuto/apollo/tree/master/modules/drivers/velodyne">Velodyne driver doc</a></p>
<pre><code>roslaunch velodyne export_pcd_offline.launch
</code></pre>

<h4 id="12-playing-ros-bag">1.2 Playing ROS bag</h4>
<p>The default directory of ROS bag is <code>/apollo/data/bag</code>. Assume the file name of ROS bag is <code>example.bag</code>.</p>
<pre><code>cd /apollo/data/bag
rosbag play --clock example.bag
</code></pre>

<p>When playing the bag, the PCD files will be dumped in the export directory (defalut: <code>/apollo/data/pcd</code>). The extracted PCD files are named according to their frame numbers which correspond to the order of playing the recorded messages from the point cloud ROS topic (e.g., <code>/apollo/sensor/velodyne64/compensator/PointCloud2</code>). In addition, there are two other files (<code>stamp.txt</code> and <code>pose.txt</code>) generated in the export directory. They will be used to generate the Pose file for each frame.</p>
<h4 id="13-generating-pose-files">1.3 Generating Pose files</h4>
<p>We provide a Python script <code>gen_pose_file.py</code> to generate the Pose files from <code>pose.txt</code>.</p>
<pre><code>cd /apollo/modules/perception/tool
python gen_pose_file.py /apollo/data/pcd
</code></pre>

<p>The names of the generated Pose files correspond to their frame numbers as the PCD files. It means that the names of PCD and Pose files for a frame is the same but have different extension names (i.e., .pcd and .pose respectively).</p>
<h3 id="2-build-the-offline-perception-visualizer">2. Build The Offline Perception Visualizer</h3>
<p>We use Bazel to build the offline perception visualizer</p>
<pre><code>cd /apollo
bazel build -c opt //modules/perception/tool/offline_visualizer_tool:offline_lidar_visualizer_tool
</code></pre>

<p>The option <code>-c opt</code> is used for building the program with optimized performance, which is important for the offline simulation and visualization of the perception module in real time.
If you'd like to run the perception module with GPU, please use the command below:</p>
<pre><code>bazel build -c opt --cxxopt=-DUSE_GPU //modules/perception/tool/offline_visualizer_tool:offline_lidar_visualizer_tool
</code></pre>

<h3 id="3-run-the-visualizer-with-offline-perception-simulation">3. Run The Visualizer With Offline Perception Simulation</h3>
<p>Before running the visualizer, you may setup the data directories and the algorithm module settings in the configuration file <code>/apollo/modules/perception/tool/offline_visualizer_tool/conf/offline_lidar_perception_test.flag</code>. The detailed parameter settings for each algorithm module can be set according to the corresponding configuration files in <code>/apollo/modules/perception/tool/offline_visualizer_tool/conf/config_manager.config</code>. Then you may run the visualizer with offline perception simulation by the command below:</p>
<pre><code>/apollo/bazel-bin/modules/perception/tool/offline_visualizer_tool/offline_lidar_visualizer_tool
</code></pre>

<p>Now you will see a pop-up window showing the perception result with point cloud frame-by-frame. The obstacles are shown with a purple rectangle bounding boxes. There are three modes to visualize the point cloud with/without the ROI area:
* Showing all the point cloud with grey color;
* Showing the point cloud of ROI area only with green color;
* Showing the point cloud of ROI area with green color and that of other areas with grey color. You may press the <code>S</code> key on keyboard to switch the modes in turn.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
