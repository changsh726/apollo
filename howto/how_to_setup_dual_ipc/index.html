<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>How to set up Apollo 3.5's software on Dual-IPCs - Apollo Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Apollo Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../quick_start.md" class="nav-link">Get Started</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Cyber RT <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../cyber/" class="dropdown-item">Introduction to Cyber RT</a>
</li>
                                    
<li>
    <a href="../../cyber/cyber_rt_quick_start.md" class="dropdown-item">Cyber RT Quick Start</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../FAQs/" class="nav-link">FAQs</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/ApolloAuto/apollo/edit/master/docs/howto/how_to_setup_dual_ipc.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#how-to-set-up-apollo-35s-software-on-dual-ipcs" class="nav-link">How to set up Apollo 3.5's software on Dual-IPCs</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#software" class="nav-link">Software</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#runtime-framework" class="nav-link">Runtime Framework</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#installation" class="nav-link">Installation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#future-work-to-do" class="nav-link">Future work (To Do)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#license" class="nav-link">License</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="how-to-set-up-apollo-35s-software-on-dual-ipcs">How to set up Apollo 3.5's software on Dual-IPCs</h1>
<p>The modules of Apollo 3.5 are separately launched from two industrial PCs. This guide introduces the hardware/software setup on two parallel IPCs.</p>
<h2 id="software">Software</h2>
<ul>
<li>Apollo 3.5</li>
<li>Linux precision time protocol </li>
</ul>
<h2 id="runtime-framework">Runtime Framework</h2>
<ul>
<li>CyberRT</li>
</ul>
<h2 id="installation">Installation</h2>
<p>There are two steps in the installation process:
 - Clone and install linux PTP code on both of IPCs
 - Clone Apollo 3.5 Github code on both of IPCs</p>
<h3 id="clone-and-install-linux-ptp">Clone and install linux PTP</h3>
<p>Install PTP utility and synchorize the system time on both of IPCs.</p>
<p>```sh
    git clone https://github.com/richardcochran/linuxptp.git
    cd linuxptp
    make</p>
<pre><code># on IPC1:
sudo ./ptp4l -i eth0 -m &amp;

# on IPC2:
sudo ./ptp4l -i eth0 -m -s &amp;
sudo ./phc2sys -a -r &amp;
</code></pre>
<p>```</p>
<h3 id="clone-apollo-35">Clone Apollo 3.5</h3>
<p>Install Apollo 3.5 on local ubuntu machine
  <code>sh
    git clone https://github.com/ApolloAuto/apollo.git</code></p>
<p>### Build Docker environment
  Refer to the <a href="https://github.com/ApolloAuto/apollo/blob/master/docs/howto/how_to_build_and_release.md">How to build and release docker</a> guide</p>
<p>### Run CyberRT on both of IPCs
  1. Change directory to apollo
  <code>sh
     cd apollo</code>
  2. Start docker environment
  <code>sh
     bash docker/scripts/dev_start.sh</code>
  3. Enter docker environment
  <code>sh
     bash docker/scripts/dev_into.sh</code>
  4. Build Apollo in the Container:
  <code>sh
     bash apollo.sh build_opt_gpu</code>
  5. Change CYBER_IP in cyber/setup.bash to IPC1's ip address:
  <code>sh
     source cyber/setup.bash</code>
  6. Start CyberRT and Dreamview:
  <code>sh
     bash scripts/bootstrap.sh</code></p>
<ol>
<li>
<p>Open Chrome and go to localhost:8888 to access Apollo Dreamview:</p>
<ul>
<li>
<p>on IPC1 </p>
<p>The header has 3 drop-downs, mode selector, vehicle selector and map selector. </p>
<p><img alt="IPC1 Task" src="../images/IPC1_dv.png" /></p>
<p>Select mode, for example "ipc1 Mkz Standard Debug" </p>
<p><img alt="IPC1 mode" src="../images/IPC1_mode.png" /> </p>
<p>Select vehicle, for example "Mkz Example"</p>
<p><img alt="IPC1 car" src="../images/IPC1_car.png" /></p>
<p>Select map, for example "Sunnyvale Big Loop"  </p>
<p><img alt="IPC1 map" src="../images/IPC1_map.png" /> </p>
<p>All the tasks that you could perform in DreamView, in general, setup button turns on all the modules. </p>
<p><img alt="IPC1 setup" src="../images/IPC1_setup.png" /></p>
<p>All the hardware components should be connected to IPC1 and the modules, localization, perception, routing, recorder, traffic light and transform, are allocated on IPC1 also.</p>
<p>Module Control on sidebar panel is used to check the modules on IPC1   </p>
<p><img alt="IPC1 check" src="../images/IPC1_check.png" /> </p>
<p>In order to open dreamview on IPC2, user must stop it on IPC1 by using the below command:
<code>sh
  # Stop dreamview on IPC1
  bash scripts/bootstrap.sh stop</code></p>
</li>
<li>
<p>on IPC2 
    Change CYBER_IP in cyber/setup.bash to IPC2's ip address:
    <code>sh
      source cyber/setup.bash</code></p>
<p>Start dreamview on IPC2 by using the below command:</p>
<p><code>sh
  # Start dremview on IPC2
  bash scripts/bootstrap.sh</code></p>
<p>Select mode, vehicle and map on dreamview as the same operations on IPC1
<img alt="IPC2 Task" src="../images/IPC2_setup.png" /></p>
<p>The modules - planning, prediction and control are assigned on IPC2.</p>
<p>Module Control on sidebar panel is used to check the modules on IPC2   </p>
<p><img alt="IPC2 modules" src="../images/IPC2_check.png" /> </p>
<p><a href="https://github.com/ApolloAuto/apollo/blob/master/docs/specs/dreamview_usage_table.md">See Dreamview user's guide</a></p>
</li>
</ul>
</li>
<li>
<p>How to start/stop Dreamview:</p>
</li>
</ol>
<p>The current version of Dreamview shouldn't run on the different IPCs simultaneously, so the user must perform it alternatively on IPC1 or IPC2. </p>
<p>The code below can be used to stop Dreamview on IPC2 and start it on IPC1.</p>
<p>```sh
     # Stop Dreamview on IPC2
     bash scripts/bootstrap.sh stop</p>
<pre><code> # Start Dreamview on IPC1
 bash scripts/bootstrap.sh
</code></pre>
<p>```</p>
<ol>
<li>
<p>Cyber monitor</p>
<p>Cyber monitor is CyberRT's tool used to check the status of all of the modules on local and remote machines. The User may observe the activity status of all the hardware and software components and ensure that they are working correctly.   </p>
</li>
</ol>
<h2 id="future-work-to-do">Future work (To Do)</h2>
<ul>
<li>Multiple Dreamviews may run simultaneously</li>
<li>Fix a bug that modules are still greyed-out after clicking the setup button. Users may check each modules' status by using the command
  <code>sh
     ps aux | grep mainboard</code></li>
</ul>
<h1 id="license">License</h1>
<p><a href="https://github.com/ApolloAuto/apollo/blob/master/LICENSE">Apache license</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
