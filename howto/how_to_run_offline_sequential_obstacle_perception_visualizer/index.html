<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>How to Run the Fusion Obstacle Visualization Tool - Apollo Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Apollo Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../quick_start.md" class="nav-link">Get Started</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Cyber RT <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../cyber/" class="dropdown-item">Introduction to Cyber RT</a>
</li>
                                    
<li>
    <a href="../../cyber/cyber_rt_quick_start.md" class="dropdown-item">Cyber RT Quick Start</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../FAQs/" class="nav-link">FAQs</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/ApolloAuto/apollo/edit/master/docs/howto/how_to_run_offline_sequential_obstacle_perception_visualizer.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#how-to-run-the-fusion-obstacle-visualization-tool" class="nav-link">How to Run the Fusion Obstacle Visualization Tool</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#prepare-the-source-data" class="nav-link">Prepare the Source Data</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#build-the-fusion-obstacle-visualization-tool" class="nav-link">Build the Fusion Obstacle Visualization Tool</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#run-the-tool" class="nav-link">Run the Tool</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="how-to-run-the-fusion-obstacle-visualization-tool">How to Run the Fusion Obstacle Visualization Tool</h1>
<p>Apollo created the LiDAR Obstacle Visualization Tool, an offline visualization tool to show LiDAR-based obstacle perception results (see <a href="https://github.com/ApolloAuto/apollo/blob/master/docs/howto/how_to_run_offline_perception_visualizer.md">How to Run Offline Perception Visualizer</a>). However, the tool lacks the ability to visualize the radar-based obstacle perception results and the fusion results based on its two sensors. </p>
<p>Apollo has developed a second visualization tool, the Fusion Obstacle Visualization Tool, to complement the LiDAR Obstacle Visualization Tool. The Fusion Obstacle Visualization Tool shows obstacle perception results from these modules:</p>
<ul>
<li>LiDAR-based algorithm module </li>
<li>Radar-based algorithm module</li>
<li>Fusion algorithm module for debugging and testing the complete obstacle perception algorithms</li>
</ul>
<p>All of the visualization is based on LiDAR data visualization. The source data from LiDAR (a set of 3D points to shape any object in the scene) is better than radar in depicting the visual features of an entire scene. Go to the Apollo web site to see the <a href="http://apollo.auto/platform/perception.html">demo videos</a> for the Fusion Obstacle Visualization Tool.</p>
<p>In general, you follow three steps to build and run the Fusion Obstacle Visualization Tool in Docker:</p>
<ol>
<li>Prepare the source data.</li>
<li>Build the Fusion Obstacle Visualization Tool.</li>
<li>Run the tool.</li>
</ol>
<p>The next three sections provide the details for each of the three steps.</p>
<h2 id="prepare-the-source-data">Prepare the Source Data</h2>
<p>Before running the Fusion Obstacle Visualization Tool, you need to prepare the following for:</p>
<h5 id="lidar-based-obstacle-perception">LiDAR-Based Obstacle Perception</h5>
<ul>
<li>Point Cloud Data (PCD) file</li>
<li>Host vehicle pose</li>
</ul>
<h5 id="radar-based-obstacle-perception">Radar-Based Obstacle Perception</h5>
<ul>
<li>Radar source obstacle data in the protocol buffers (protobuf) format</li>
<li>Host vehicle pose</li>
<li>Host vehicle velocity</li>
</ul>
<p>To facilitate the data extraction, Apollo provides a tool named <code>export_sensor_data</code> to export the data from a ROS bag.</p>
<h3 id="steps">Steps</h3>
<ol>
<li>Build the data exporter using these commands:</li>
</ol>
<pre><code>cd /apollo
bazel build //modules/perception/tool/export_sensor_data:export_sensor_data
</code></pre>

<ol>
<li>Run the data exporter using this command:</li>
</ol>
<pre><code>/apollo/bazel-bin/modules/perception/tool/export_sensor_data/export_sensor_data
</code></pre>

<ol>
<li>Play the ROS bag.   </li>
</ol>
<p>​       The default directory of the ROS bag is <code>/apollo/data/bag</code>. 
​       In the following example, the file name of ROS bag is <code>example.bag</code>.</p>
<p>​      Use these commands:</p>
<pre><code>cd /apollo/data/bag
rosbag play --clock example.bag --rate=0.1
</code></pre>

<p>To ensure that you do not miss any frame data when performing callbacks to the ROS messages, it is recommended that you reduce the playing rate, which is set to <code>0.1</code> in the example above. </p>
<p>When you play the bag, all data files are dumped to the export directory, using the timestamp as the file name, frame by frame. </p>
<p>The default LiDAR data export directory is <code>/apollo/data/lidar</code>.</p>
<p>The radar directory is <code>/apollo/data/radar</code>. </p>
<p>The directories can be defined in <code>/apollo/modules/perception/tool/export_sensor_data/conf/export_sensor_data.flag</code> using the flags, <code>lidar_path</code> and <code>radar_path</code>.</p>
<p>In the <code>lidar_path</code>, two types of files are generated with the suffixes: <em><code>.pcd</code></em> and <em><code>.pose</code></em>.</p>
<p>In the <code>radar_path</code>, three types of files are generated with the suffixes <em><code>.radar</code></em>, <em><code>.pose</code></em>, and <em><code>.velocity</code></em>.</p>
<h2 id="build-the-fusion-obstacle-visualization-tool">Build the Fusion Obstacle Visualization Tool</h2>
<p>Apollo uses the Bazel tool to build the Fusion Obstacle Visualization Tool.</p>
<ol>
<li>Build the Fusion Obstacle Visualization Tool using these commands:</li>
</ol>
<pre><code>cd /apollo
bazel build -c opt //modules/perception/tool/offline_visualizer_tool:offline_sequential_obstacle_perception_test
</code></pre>

<p>The <code>-c opt</code> option is used to build the program with optimized performance, which is important for the offline simulation and visualization of the perception module in real time.</p>
<ol>
<li>(Optional) If you want to run the perception module with GPU, use this command:</li>
</ol>
<pre><code>bazel build -c opt --cxxopt=-DUSE_GPU //modules/perception/tool/offline_visualizer_tool:offline_sequential_obstacle_perception_test
</code></pre>

<h2 id="run-the-tool">Run the Tool</h2>
<p>Before running the Fusion Obstacle Visualization Tool, you can set up the source data directories and the algorithm module settings in the configuration file: <code>/apollo/modules/perception/tool/offline_visualizer_tool/conf/offline_sequential_obstacle_perception_test.flag</code>. </p>
<p>The default source data directories are <code>/apollo/data/lidar</code>and <code>/apollo/data/radar</code> for <code>lidar_path</code> and <code>radar_path</code>, respectively. </p>
<p>The visualization-enabling Boolean flag is <code>true</code>, and the obstacle result type to be shown is <code>fused</code> (the fusion obstacle results based on both LiDAR and RADAR sensors) by default.  You can change  <code>fused</code> to <code>lidar</code> or <code>radar</code> to visualize the pure obstacle results generated by the single-sensor-based obstacle perception.</p>
<p>Run the Fusion Obstacle Visualization Tool using this command:</p>
<pre><code>/apollo/bazel-bin/modules/perception/tool/offline_visualizer_tool/offline_sequential_obstacle_perception_test
</code></pre>

<p>You see results such as:</p>
<ul>
<li>A pop-up window showing the perception result with the point cloud, frame-by-frame </li>
<li>The raw point cloud shown in grey </li>
<li>Bounding boxes (with red arrows that indicate the headings) that have detected:</li>
<li>Cars (green)</li>
<li>Pedestrians (pink)</li>
<li>Cyclists (blue)</li>
<li>Unknown elements (purple) </li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
