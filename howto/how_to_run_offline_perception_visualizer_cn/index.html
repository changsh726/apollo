<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>如何运行脱机感知可视化 - Apollo Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Apollo Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../quick_start.md" class="nav-link">Get Started</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Cyber RT <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../cyber/" class="dropdown-item">Introduction to Cyber RT</a>
</li>
                                    
<li>
    <a href="../../cyber/cyber_rt_quick_start.md" class="dropdown-item">Cyber RT Quick Start</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../FAQs/" class="nav-link">FAQs</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/ApolloAuto/apollo/edit/master/docs/howto/how_to_run_offline_perception_visualizer_cn.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#_1" class="nav-link">如何运行脱机感知可视化</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="_1">如何运行脱机感知可视化</h1>
<p>DreamView工具可以模拟感知模块并展现模拟效果，但它缺乏可视化点云和ROI区域的能力，这有助于调试和测试感知算法。为此，我们提供了一个基于OpenGL和PCL库的离线可视化工具，以显示点云的障碍感知结果。详细信息请参考 <a href="http://apollo.auto/platform/perception.html">官网</a> 关于离线可视化工具的介绍。</p>
<p>我们将介绍在docker中构建和运行离线可视化工具的详细步骤，如下所示:</p>
<h3 id="1-pcdpose">1. 准备PCD和Pose数据</h3>
<p>在运行可视化工具之前，我们需要准备必要的PCD和Pose数据，这些数据可以从带有记录点云数据的ROS包中提取。为了便于数据提取，我们提供了一个ROS启动文件来转储PCD帧文件和一个python脚本来为每个帧生成Pose文件。</p>
<h4 id="11-pcd">1.1 启动PCD导出器</h4>
<p>更多详细信息请参考 <a href="https://github.com/ApolloAuto/apollo/tree/master/modules/drivers/velodyne">Velodyne驱动文档</a></p>
<pre><code>roslaunch velodyne export_pcd_offline.launch
</code></pre>

<h4 id="12-ros-bag">1.2 播放 ROS bag</h4>
<p>默认的ROS bag目录在<code>/apollo/data/bag</code>。假设ROS bag的文件名是<code>example.bag</code>.</p>
<pre><code>cd /apollo/data/bag
rosbag play --clock example.bag
</code></pre>

<p>播放包时，PCD文件将被转储到导出目录（defalut：<code>/ apollo / data / pcd</code>）。提取的PCD文件根据它们的帧号命名，帧号对应于从点云ROS主题播放记录时消息的顺序（例如，<code>/ apollo / sensor / velodyne64 / compensator / PointCloud2</code>）。此外，在导出目录中还有另外两个文件（<code>stamp.txt</code>和<code>pose.txt</code>）。它们将用于为每个帧生成Pose文件。</p>
<h4 id="13-pose">1.3 生成Pose文件</h4>
<p>Python脚本 <code>gen_pose_file.py</code> 用来根据文件<code>pose.txt</code>生成Pose文件。</p>
<pre><code>cd /apollo/modules/perception/tool
python gen_pose_file.py /apollo/data/pcd
</code></pre>

<p>与生成Pose文件名称对应的帧编号作为PCD文件名。也就是帧的PCD和Pose文件的名称相同但具有不同的扩展名（即分别为.pcd和.pose）。</p>
<h3 id="2">2. 构建离线感知可视化工具</h3>
<p>使用Bazel构建离线可视化工具</p>
<pre><code>cd /apollo
bazel build -c opt //modules/perception/tool/offline_visualizer_tool:offline_lidar_visualizer_tool
</code></pre>

<p>选项<code>-c opt</code>用于构建具有优化性能的程序，这对于实时感知模块的离线模拟和可视化非常重要。
如果您想使用GPU运行感知模块，请使用以下命令：</p>
<pre><code>bazel build -c opt --cxxopt=-DUSE_GPU //modules/perception/tool/offline_visualizer_tool:offline_lidar_visualizer_tool
</code></pre>

<h3 id="3">3. 使用离线感知模拟运行可视化工具</h3>
<p>在运行可视化工具之前，您可以在配置文件<code>/apollo/modules/perception/tool/offline_visualizer_tool/conf/offline_lidar_perception_test.flag</code>中设置数据目录和算法模块设置。每个算法模块的详细参数设置可以根据相应的配置文件<code>/apollo/modules/perception/tool/offline_visualizer_tool/conf/config_manager.config</code>进行设置。然后，您可以通过以下命令运行具有离线感知模拟的可视化工具：</p>
<pre><code>/apollo/bazel-bin/modules/perception/tool/offline_visualizer_tool/offline_lidar_visualizer_tool
</code></pre>

<p>现在，可以看到一个弹出窗口，逐帧显示点云的感知结果。障碍物用紫色矩形边界框显示。ROI区域的点云可视化有三种模式：
* 显示灰色的所有点云；
* 仅用绿色显示ROI区域的点云；
* 显示绿色ROI区域的点云和灰色的其他区域的点云。 您可以按键盘上的<code>S</code>键依次切换模式。</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
