<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Vehicle Control Calibration - Apollo Docs</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">Apollo Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../quick_start.md" class="nav-link">Get Started</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Cyber RT <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../cyber/" class="dropdown-item">Introduction to Cyber RT</a>
</li>
                                    
<li>
    <a href="../../../cyber/cyber_rt_quick_start.md" class="dropdown-item">Cyber RT Quick Start</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../../FAQs/" class="nav-link">FAQs</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/ApolloAuto/apollo/edit/master/docs/specs/calibration_table/control_calibration.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#vehicle-control-calibration" class="nav-link">Vehicle Control Calibration</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#data-uploaddownload" class="nav-link">Data Upload/Download</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#folder-structure-requirement" class="nav-link">Folder Structure Requirement</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#result-visualization" class="nav-link">Result Visualization</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="vehicle-control-calibration">Vehicle Control Calibration</h1>
<p>Control calibration system automatically generates calibration table for different vehicle models. It includes three parts: a frontend data collection monitor system, a data pipeline upload/download tool for uploading collected data and downloading generated calibration tables, and a visualization tool for performance evaluation.</p>
<!-- # Table of Contents 1\. [Frontend](#frontend) 2\. [Data](#data) - [Upload Tool](#upload) - [Download Tool](#download) 3\. [Visulization](#visulization) -->

<p>## Frontend</p>
<p>In DreamView, a data collection monitor is presented for monitoring the data calibration process. In vehicle calibration mode, collected data frames are visualized in the data calibration monitor. Data frames are categorized into different driving conditions according to their chassis information. The amount of collected data frames are indicated as progress bars.</p>
<h3 id="setup">Setup</h3>
<p>In the on-vehicle DreamView environment,</p>
<ol>
<li>Choose <code>vehicle calibration</code> in <code>--setup mode--</code>,</li>
<li>Choose <code>Data Collection Monitor</code> at <code>Others</code> panel.</li>
</ol>
<p><img alt="" src="../images/calibration_table.png" /></p>
<p>The data collection monitor is displayed in DreamView.</p>
<h3 id="data-collection">Data collection</h3>
<p>When driving, data frames are automatically processed by reading their chassis messages. When a data frame satisfy the speed criterion (speed equal or larger than 0.2 mps), the data frame is categorized by its steering, speed and throttle/brake information. The data collection process is presented by bars in data collection monitor.</p>
<p>There are 21 bars in total in data collection monitor. The overall process is indicated by the top bar. The rest 20 bars indicate 20 driving conditions, including</p>
<ul>
<li>
<p>Six brake conditions at different speed level</p>
</li>
<li>
<p>low speed (&lt;10 mps) brake pulse</p>
</li>
<li>middle speed (10 mps ~ 20 mps ) brake pulse</li>
<li>high speed (&gt;=20 mps) brake pulsing</li>
<li>low speed ( &lt;10 mps) brake tap</li>
<li>middle speed (10 mps ~ 20 mps ) brake tap</li>
<li>
<p>high speed (&gt;=20 mps) brake tap</p>
</li>
<li>
<p>Six throttle conditions at different speed level</p>
</li>
<li>
<p>low speed (&lt;10 mps) under throttle</p>
</li>
<li>middle speed (10 mps ~ 20 mps ) under throttle</li>
<li>high speed (&gt;=20 mps) under throttle</li>
<li>low speed ( &lt;10 mps) harsh throttle</li>
<li>middle speed (10 mps ~ 20 mps ) harsh throttle</li>
<li>
<p>high speed (&gt;=20 mps) harsh throttle</p>
</li>
<li>
<p>Eight steering angle conditions</p>
</li>
<li>
<p>left 0% ~ 20%</p>
</li>
<li>left 20% ~ 40%</li>
<li>left 40% ~ 60%</li>
<li>left 60% ~ 100%</li>
<li>right 0% ~ 20%</li>
<li>right 20% ~ 40%</li>
<li>right 40% ~ 60%</li>
<li>right 60% ~ 100%</li>
</ul>
<p>For each bar, there is a blue ribbon indicating collected data frames. When the blue ribbon fills the whole bar, the number of collected frames reaches the target number. There is also a number at right end of each bar indicating the completion percentage.</p>
<p>For calibration table data collection, when the first 13 bars (total progress bar and 12 brake/throttle condition bars) reaches 100% the data collection process is considered as completed. For dynamic model data collection, the data collection process is completed when all bars reaches 100%.</p>
<p>All data are saved in <code>nvme drive</code> or <code>data/record/</code></p>
<h3 id="vehicle-configuration">Vehicle Configuration</h3>
<p>The brake and throttle specs are different between vehicle models. Therefore, the criteria for brake pulsing/tap and hash/under throttle depend on vehicle models. The default setting is based on Lincoln MKZ model. For different vehicle model, these parameters is configurable at</p>
<pre><code>/apollo/modules/dreamview/conf/mkz7_data_collection_table.pb.txt
</code></pre>

<p>(description)</p>
<h2 id="data-uploaddownload">Data Upload/Download</h2>
<h3 id="prerequisites">Prerequisites</h3>
<p>Firstly, please make sure you have already finished setting up the <strong>Apollo Fuel Proxy</strong> following documents available at:</p>
<p>https://github.com/ApolloAuto/apollo/blob/master/modules/tools/fuel_proxy/README.md</p>
<p>This is <strong>essential</strong> before you can get enjoy control calibration or other Apollo Fuel-based cloud service.</p>
<h2 id="folder-structure-requirement">Folder Structure Requirement</h2>
<p>Before uploading your data, take a note of:
1. The folder structure to be maintained is:
   <img alt="" src="../images/file_system.png" /></p>
<ol>
<li>As seen above, the file structure to be maintained is
   <code>Origin Folder -&gt; Task Folder -&gt;Vehicle Folder -&gt; Records + Configuration files</code></li>
<li>A <strong>task</strong> folder needs to be created for your calibration job, such as task001, task002...</li>
<li>A vehicle folder needs to be created for your vehicle. The name of the folder should be the same as seen in Dreamview</li>
<li>Inside your folder, create a <strong>Records</strong> folder to hold the data</li>
<li>Store all the <strong>Configuration files</strong> along with the Records folder, within the <strong>Vehicle</strong> folder</li>
<li>The vehicle configuration file (vehicle_param.pb.txt) is updated since Apollo 5.0 and later, you should check it</li>
<li>One task folder can contain more than one vehicle folder, you can  train more vehicles in one training job</li>
</ol>
<h3 id="upload">Upload</h3>
<p>Use <a href="https://cloud.baidu.com/doc/BOS/BOSCLI/8.5CBOS.20FS.html">bosfs</a> to mount
your bucket to local, for example,</p>
<pre><code>BUCKET=&lt;bucket&gt;
AK=&lt;access key&gt;
SK=&lt;secret key&gt;
MOUNT=/mnt/bos
# It's required to provide correct BOS region. Please read the document
# https://cloud.baidu.com/doc/BOS/S3.html#.E6.9C.8D.E5.8A.A1.E5.9F.9F.E5.90.8D
REGION=bj

mkdir -p &quot;${MOUNT}&quot;
bosfs &quot;${BUCKET}&quot; &quot;${MOUNT}&quot; -o allow_other,logfile=/tmp/bos-${BUCKET}.log,endpoint=http://${REGION}.bcebos.com,ak=${AK},sk=${SK}
</code></pre>

<p>Then you can copy the prepared data folder to somewhere under /mnt/bos.</p>
<h3 id="download">Download</h3>
<p>No download needed, the results will be sent to your email associated with your BOS bucket.</p>
<h2 id="result-visualization">Result Visualization</h2>
<p>The docker environment does not support Matplotlib. Thus, result are visualized outside of the docker environment. The following two figures show the visualization result of PC training results.</p>
<p><img alt="" src="../images/throttle.png" /></p>
<p><img alt="" src="../images/brake.png" /></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
